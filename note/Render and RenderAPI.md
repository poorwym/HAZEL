# Render and Render API
![渲染API](pictures/屏幕截图%202025-01-25%20002138.png)

---

## 左侧：Renderer（与具体 API/平台无关）

- **2D & 3D Renderer**  
  - 这里指图形渲染的核心流程，既包含二维渲染（UI、2D精灵等）也包含三维渲染。  
  - 常见渲染路径有**前向渲染（Forward Rendering）**、**延迟渲染（Deferred Rendering）**等不同策略。

- **Scene Graph（场景图/场景管理）**  
  - 用来组织场景中的各种对象（模型、灯光、摄像机等），方便进行层级化的管理和遍历。  
  - 场景图可以包含父子关系、包围盒等信息，为后续的**裁剪、排序**等功能提供支持。

- **Sorting（排序）**  
  - 按照一定准则（例如透明度、不透明度、渲染队列顺序、状态变化）对场景中的可渲染对象进行排序。  
  - 目的是减少渲染状态切换、提升渲染效率，或者保证正确的透明效果等。

- **Culling（裁剪）**  
  - 通过视锥体裁剪（Frustum Culling）、遮挡裁剪（Occlusion Culling）等手段，过滤掉在当前相机视图外或被遮挡的对象，减少无用的绘制。

- **Materials（材质系统）**  
  - 管理物体的外观属性（纹理、光照模型、着色参数等），把渲染所需的 shader、纹理、常量数据组织起来。

- **LOD（Level of Detail，细节层次）**  
  - 根据对象距离或屏幕占比，切换不同精度的模型、贴图等，以节省性能。

- **Animation（动画）**  
  - 负责对角色、场景对象的骨骼动画、形变动画等进行更新，最终将更新后的顶点信息传递给渲染层。

- **Camera（摄像机）**  
  - 定义视图、投影参数（视野角度、近远平面等），决定场景被如何绘制到屏幕上。

- **VFX（视觉特效）**  
  - 特殊效果，比如粒子系统、光效、爆炸效果等。

- **PostFX（后期处理效果）**  
  - 在完成主要渲染后，对最终图像进行二次处理（例如Bloom、Tone Mapping、HDR、景深、屏幕空间反射等）。

- **Other things（其它功能）**  
  - 比如反射（Reflections）、环境光遮蔽（Ambient Occlusion）等高级渲染特性或附加模块。

这些功能模块**本身与具体渲染 API 无关**，可在不同平台/图形 API 上复用，通常由引擎的上层逻辑来组织和编写。

---

## 右侧：Render API（与具体 API/平台相关）

- **Render Context（渲染上下文）**  
  - 指底层图形 API 的上下文对象，通常负责维护 GPU 与程序之间的状态，管理命令队列、设备等。  
  - 不同平台、不同 API（如 OpenGL、DirectX、Vulkan、Metal）都有自己独特的创建和管理方式。

- **Swap Chain（交换链）**  
  - 负责管理显示缓冲区的呈现模式，如在双缓冲或三缓冲之间进行图像的交换（前缓冲/后缓冲），以便最终在屏幕上显示。

- **Framebuffer（帧缓冲）**  
  - 渲染输出的目标缓冲，可以包含颜色缓冲、深度缓冲、模板缓冲等，用来存储当前帧的图像数据、深度信息等。

- **Vertex Buffer（顶点缓冲）**  
  - 用于存储场景中要绘制的顶点数据（位置、法线、纹理坐标等）。

- **Index Buffer（索引缓冲）**  
  - 用于存储索引数据，让同一组顶点可以按索引方式组合成三角形等图元，提高数据重用率。

- **Texture（纹理）**  
  - 储存图像数据（如 Diffuse、Normal、Specular 等贴图），渲染时会绑定到管线传递给着色器使用。

- **Shader（着色器）**  
  - 在 GPU 上运行的程序（如顶点着色器、片元着色器、几何着色器、计算着色器等），负责对图形进行变换、光照计算、像素处理等。

- **States（渲染状态）**  
  - 例如混合模式、深度测试、模板测试、背面剔除等一系列 GPU 管道状态，需要根据不同需求进行配置。

- **Pipelines（管线）**  
  - 指一套绑定好着色器、缓冲区、状态等资源的完整渲染“管线对象”（在 Vulkan、Metal 等 API 中尤为常见），用于高效地提交绘制命令。

- **Render Passes（渲染通道）**  
  - 一次或多次对帧缓冲的渲染操作，每个 pass 中可以定义渲染目标、清屏、深度、混合、附件（attachments）等配置，用来管理渲染顺序和阶段。

这些概念**高度依赖底层图形 API 或特定平台特性**，需要根据所使用的 API（OpenGL、DirectX、Vulkan、Metal 等）进行不同的接口调用和管理。

---

### 总结

- **Renderer**（左侧）关注的是引擎的“渲染逻辑和调度”，在多平台/多种图形 API 下通用。  
- **Render API**（右侧）关注的是具体图形 API 的调用方式、对象管理和硬件交互。  

这种划分使得渲染模块更易于在不同平台上移植或替换底层 API，同时保持上层渲染逻辑的一致性。  

## wym note
这里很有趣一点是**贴图**依赖于platform但是**材质**不依赖与platform。
不同的platform会需要不同的render api，比如pipeline这个概念在vulkan中从存在，但是在opengl中不存在。所以renderer不会用到所有设计的render api。

